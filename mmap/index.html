<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8" />
	<title> Marauder's Map </title>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<script src="http://maps.google.com/maps/api/js?sensor=true"></script>
	<link rel="stylesheet" href="mingmap.css" />
	
	<script>

		myLat = 0;
		myLng = 0;

	    function init(){

	    	console.log("1. In init before geolocation");

	    	if(navigator.geolocation){
	    	//google maps has been approved to see your location		
	    		navigator.geolocation.getCurrentPosition(function(position){
	    			console.log("2. Got your location");
	    			//set my position
	    			myLat = position.coords.latitude;
	    			myLng = position.coords.longitude;
	    			mymap(myLat, myLng);
	    			console.log("3. Leaving the getCurrentPosition function");
	    		});
	    	}
	    	console.log("4. Leaving init()");

	    }

	    function mymap(myLat, myLng){
	    	//my location is set in longitude and latitude
	    	var me = new google.maps.LatLng(myLat, myLng);
    		
    		// Set up Google Map
			var mapOptions = {
	          	zoom: 14,
	          	center: me,
	          	mapTypeId: google.maps.MapTypeId.ROADMAP
	        };

	        // Create the map_canvas
	        var map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);

	        //Create a marker
	        var marker = new google.maps.Marker({
	        	position: me,
	        	title: "You Are Here"
	        });

	        //Create info window for the marker
	        marker.setMap(map);
	        var infowindow = new google.maps.InfoWindow();

	        // Create request to send geolocation information  
	    	request = new XMLHttpRequest();

	    	request.open("POST", https://secret-about-box.herokuapp.com/sendLocation, true);

	    	request.onreadystatechange = parseData;

	    	request.send();	

	        //Set up marker pop up in relation to the "click" action 
	        google.maps.event.addListener(marker, 'click', function(){
	        	infowindow.setContent(marker.title);
	        	infowindow.open(map, marker);
	        });
	    }
	    
	    function parseData(){
	    	otherLat = 0;
	    	otherLng = 0;
	    	username = "empty";

	    	if request.readyState == 4){

	    		var locationsDiv = document.getElementById( "location");

	    		var converted = JSON.parse(request.responseText);

	    		for (i =0; i < converted.length; i++){
	    			otherLat = converted[i]["lat"];
	    			otherLng = converted[i]["lng"];
	    			username = converted[i]["login"];

	    		}
	    	}
	    }
	     


	</script>
	
	</head>

	<body onload = "init()">
           
    <div id="map_canvas"></div>


	</body>

</html>
